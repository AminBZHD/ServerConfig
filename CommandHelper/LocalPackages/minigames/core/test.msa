/apiget = >>>

@tournamentName = 'moops'
@tournamentURL = @tournamentName.'_omnivs'
@matchID = 88443733
@winnerID = 55979279
@score = '1-0'
@challongeKey = 'gJh1MQsb85UyFETsBYZMakcd6uZfHd0Rh4MfjYDy'

# Request to get JSON about a specific match
# https://api.challonge.com/v1/documents/matches/show
@url = 'https://api.challonge.com/v1/tournaments/'.@tournamentURL.'/matches/'.@matchID.'.json'
http_request(@url, array(
    method: 'GET',
    headers: array(
     'Content-Type': 'application/json'
    ),
    # params from the website
    params: array(
     'api_key': @challongeKey
    ),
    # Server Response
    success: closure(@response){
        # If the server throws an error
        if(@response['responseCode'] != 200){
            tmsg(@plr,color(red).'Error!')
            # Full debug reponse along with url
            msg(@response)
            msg(@url)
            @error = json_decode(@response['body'])
            foreach(@error in @error['errors']){
                tmsg(@plr,color(red).@error)
            }
            die()
        }
        # Successful resposne from the API and displays the array of info
        msg(json_decode(@response['body']))
        msg('Success!')
    }
))


<<<

/apiset = >>>

@tournamentName = 'moops'
@tournamentURL = @tournamentName.'_omnivs'
@matchID = 88443733
@winnerID = 55979279
@score = '1-0'
@challongeKey = 'gJh1MQsb85UyFETsBYZMakcd6uZfHd0Rh4MfjYDy'

# Uncomment this one to try it - suggest commenting the above block
# https://api.challonge.com/v1/documents/matches/update
# Update score to the match above, declaring player 1 the winner with a score of 1 to 0
@url = 'https://api.challonge.com/v1/tournaments/'.@tournamentURL.'/matches/'.@matchID.'.json'
http_request(@url, array(
    method: 'POST',
    headers: array(
     'Content-Type': 'application/json',
     'Content-Length': '0'
    ),
    # params from the website
    params: array(
     'api_key': @challongeKey,
     '_method': 'put', # CH supports the PUT method, but I had trouble using it - this way succeeds in getting a JSON response
     'score_csv': @score,
     'winner_id': @winnerID,
     'player1_votes': '1',
     'player2_votes': '0',
    ),
    # Actual Success
    success: closure(@response){
        if(@response['responseCode'] != 200){
            msg(color(red).'Error!')
            msg(@response)
            msg(@url)
            @error = json_decode(@response['body'])
            foreach(@error in @error['errors']){
                msg(color(red).@error)
            }
            die()
        }
        msg(json_decode(@response['body']))
        msg('Success!')
    }
))

<<<
